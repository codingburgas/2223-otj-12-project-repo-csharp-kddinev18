@using System.Text.Json.Nodes;
@model WebApp.DataTransferObjects.DevicesDataTransferObject

@{
    ViewData["Title"] = "Devices";
}
@{
    string currentDeviceName = TempData["CurrentDevice"].ToString();
    int pageNumber = int.Parse(TempData["PageNumber"].ToString());
    int totalPages = int.Parse(TempData["TotalPages"].ToString());
    int previousPage = pageNumber - 1;
    int nextPage = pageNumber + 1;
    int entriesCount = int.Parse(TempData["EntriesCount"].ToString());
    DateTime lastEntry = DateTime.Parse(TempData["LastEntry"].ToString());
    DateTime tempDate = DateTime.Now;
}

<div class="d-flex flex-row" style="margin:60px 0 0 0; width:100%">
    <!-- Sidebar -->
    <nav class="collapse d-lg-block sidebar collapse bg-white">
        <div class="position-sticky">
            <div class="list-group list-group-flush mx-3 mt-4">
                <!-- Collapse 1 -->
                <a class="list-group-item list-group-item-action py-2 ripple d-flex justify-content-center">
                    <i class="ri-menu-line"></i><span>Menu</span>
                </a>
                <!-- Collapsed content -->
                <ul id="collapseExample1" class="collapse show list-group list-group-flush">
                    @foreach (string deviceName in Model.DeviceNames)
                    {
                        <li class="list-group-item py-1">
                            <a asp-area="" asp-controller="Devices" asp-action="Index" asp-route-deviceName="@deviceName" class="text-reset">@deviceName</a>
                        </li>
                    }
                </ul>
            </div>
        </div>
    </nav>
    <!-- Sidebar -->
    <!--Content-->
    <div class="d-flex flex-column" style="width:100%;margin: 30px 0 0 0">
        <h1>@currentDeviceName</h1>
        <br/>
        <div class="d-flex flex-row justify-content-between">

            <div class="col-lg-3 col-md-6 col-sm-6">
                <div class="card card-stats">
                    <div class="card-header ">
                        <div class="d-flex align-content-around">
                            <i class="ri-remixicon-line"></i>
                            Number of entries
                        </div>
                    </div>
                    <div class="card-body d-flex justify-content-center">
                        <p class="card-title">@entriesCount<p>
                    </div>
                </div>
            </div>
            <div class="col-lg-3 col-md-6 col-sm-6">
                <div class="card card-stats">
                    <div class="card-header ">
                        <div class="d-flex align-content-around">
                            <i class="ri-remixicon-line"></i>
                            Last Entry
                        </div>
                    </div>
                    <div class="card-body d-flex justify-content-center">
                        <p class="card-title">@lastEntry.ToString("yyyy/mm/dd hh:mm:ss")<p>
                    </div>
                </div>
            </div>
            <div class="col-lg-3 col-md-6 col-sm-6">
                <div class="card card-stats">
                    <div class="card-header ">
                        <div class="d-flex align-content-around">
                            <i class="ri-remixicon-line"></i>
                            Update Now
                        </div>
                    </div>
                    <div class="card-body d-flex justify-content-center">
                        <p class="card-title">150GB<p>
                    </div>
                </div>
            </div>
        </div>
        <br/>
        <div class="row">
            <div class="col-md-12">
                <div class="card ">
                    <div class="card-header ">
                        <h5 class="card-title">Table view</h5>
                    </div>
                    <div class="card-body ">
                        <table class="table table-striped table-hover">
                            <thead>
                                <tr>
                                    @foreach (string infrastructure in Model.Infrastructure)
                                    {
                                        <th>@infrastructure</th>
                                    }
                                </tr>
                            </thead>
                            <tbody>
                                @foreach (JsonObject dataItem in Model.Data)
                                {
                                    <tr>
                                        @foreach (string infrastructure in Model.Infrastructure)
                                        {
                                            @if (DateTime.TryParse(@dataItem[infrastructure].ToString(), out tempDate))
                                            {
                                                <td>@tempDate.ToString("yyyy/mm/dd hh:mm:ss")</td>
                                            }
                                            else
                                            {
                                                <td>@dataItem[infrastructure].ToString()</td>
                                            }
                                        }
                                    </tr>
                                }
                            </tbody>
                        </table>
                    </div>
                    <div class="card-footer ">
                        <hr>
                        @if (totalPages > 1)
                        {
                            <nav>
                                <ul class="pagination">
                                    @if (pageNumber > 1)
                                    {
                                        <li class="page-item"><a class="page-link" asp-area="" asp-controller="Devices" asp-action="Index" asp-route-pageNumber="@previousPage" asp-route-deviceName="@currentDeviceName">Previous</a></li>
                                    }

                                    @if (pageNumber > 3)
                                    {
                                        <li class="page-item"><a class="page-link" asp-area="" asp-controller="Devices" asp-action="Index" asp-route-pageNumber="1" asp-route-deviceName="@currentDeviceName">1</a></li>
                                        @if (pageNumber > 4)
                                        {
                                            <li class="page-item disabled"><a class="page-link" href="#">...</a></li>
                                        }
                                    }

                                    @for (int i = Math.Max(1, pageNumber - 2); i <= Math.Min(totalPages, pageNumber + 2); i++)
                                    {
                                        if (i == pageNumber)
                                        {
                                            <li class="page-item active"><a class="page-link" asp-area="" asp-controller="Devices" asp-action="Index" asp-route-pageNumber="@i" asp-route-deviceName="@currentDeviceName">@i</a></li>
                                        }
                                        else
                                        {
                                            <li class="page-item"><a class="page-link" asp-area="" asp-controller="Devices" asp-action="Index" asp-route-pageNumber="@i" asp-route-deviceName="@currentDeviceName">@i</a></li>
                                        }
                                    }

                                    @if (pageNumber < totalPages - 2)
                                    {
                                        @if (pageNumber < totalPages - 3)
                                        {
                                            <li class="page-item disabled"><a class="page-link" href="#">...</a></li>
                                        }
                                        <li class="page-item"><a class="page-link" asp-area="" asp-controller="Devices" asp-action="Index" asp-route-pageNumber="@totalPages" asp-route-deviceName="@currentDeviceName">@totalPages</a></li>
                                    }

                                    @if (pageNumber < totalPages)
                                    {
                                        <li class="page-item"><a class="page-link" asp-area="" asp-controller="Devices" asp-action="Index" asp-route-pageNumber="@nextPage" asp-route-deviceName="@currentDeviceName">Next</a></li>
                                    }
                                </ul>
                            </nav>
                        }
                    </div>
                </div>
            </div>
        </div>
        <br />
    </div>
</div>